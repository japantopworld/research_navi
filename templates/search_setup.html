<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>バーコードテスト</title>
  <script src="{{ url_for('static', filename='js/html5-qrcode.min.js') }}"></script>
  <script>
    window.addEventListener("DOMContentLoaded", () => {
      const badge = document.getElementById("badge");
      if (typeof Html5Qrcode !== "undefined") {
        badge.innerText = "ライブラリ読込OK（ローカル）";
        badge.style.backgroundColor = "#4CAF50";
      } else {
        badge.innerText = "ライブラリ未読込";
        badge.style.backgroundColor = "#F44336";
      }
    });

    function startBarcodeScan() {
      const html5QrCode = new Html5Qrcode("reader");
      const config = { fps: 10, qrbox: 250 };

      html5QrCode.start(
        { facingMode: "environment" },
        config,
        qrCodeMessage => {
          document.getElementById("barcode-input").value = qrCodeMessage;
          html5QrCode.stop();
          document.getElementById("reader").innerHTML = "";
        },
        errorMessage => {
          // エラー時は何もしない
        }
      ).catch(err => {
        alert("カメラ起動に失敗: " + err);
      });
    }
  </script>
</head>
<body>
  <h1>📷 バーコード読み取りテスト</h1>
  <div id="badge" style="color: white; padding: 6px 12px; border-radius: 6px; margin-bottom: 10px;">チェック中...</div>
  <input type="text" id="barcode-input" placeholder="バーコード結果" style="width: 80%; font-size: 1.2em;">
  <button onclick="startBarcodeScan()" style="font-size: 1.2em; margin-top: 10px;">📷 スキャン</button>
  <div id="reader" style="width: 300px; margin-top: 20px;"></div>
</body>
</html>

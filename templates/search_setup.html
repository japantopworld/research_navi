{% raw %}<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>å•†å“æ¤œç´¢ï¼ˆç¢ºèªç”¨ãƒŸãƒ‹ãƒãƒ ï¼‰</title>

  <!-- ãƒ­ãƒ¼ã‚«ãƒ«ã«ç½®ã„ãŸ html5-qrcode ã‚’èª­ã¿è¾¼ã‚€ï¼ˆCDNä¸è¦ï¼‰-->
  <script src="{{ url_for('static', filename='js/html5-qrcode.min.js') }}"></script>

  <style>
    body{font-family: -apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Hiragino Kaku Gothic ProN","Hiragino Sans",Meiryo,sans-serif; line-height:1.6; padding:16px;}
    .badge{background:#dff2eb;color:#0c5132;padding:.6em 1em;border-radius:10px;display:inline-block;margin:6px 0;}
    .card{border:1px solid #e5e7eb;border-radius:12px;padding:12px;margin-top:12px;}
    .btn{background:#111827;color:#fff;border:none;border-radius:10px;padding:.6em 1em;margin-right:8px}
    .btn:active{opacity:.8}
    pre{background:#0b0b0b;color:#7CFC00;border-radius:10px;padding:10px;overflow:auto}
  </style>

  <script>
    // è¨ºæ–­ç”¨ã®ã‚°ãƒ­ãƒ¼ãƒãƒ«
    window.__h5_src = "{{ url_for('static', filename='js/html5-qrcode.min.js') }}";
    window.__h5_loaded = false;
    window.__h5_err = null;

    function __h5_test() {
      return !!(window.Html5Qrcode || window.Html5QrcodeScanner);
    }
    // åŒæœŸèª­ã¿è¾¼ã¿ãªã®ã§ç›´å¾Œã«å­˜åœ¨ãƒã‚§ãƒƒã‚¯
    try { window.__h5_loaded = __h5_test(); } catch(e) { window.__h5_err = String(e); }

    document.addEventListener('DOMContentLoaded', () => {
      const diag = document.getElementById('diag');

      // â‘  JSå‹•ä½œç¢ºèª
      document.getElementById('btnCheckJs').onclick = () => {
        alert('JSã¯å‹•ã„ã¦ã„ã¾ã™ï¼ˆOKï¼‰');
      };

      // â‘¡ ãƒ©ã‚¤ãƒ–ãƒ©ãƒªèª­è¾¼ç¢ºèªï¼ˆhtml5-qrcodeï¼‰
      document.getElementById('btnCheckLib').onclick = () => {
        const ok = !!(window.Html5Qrcode || window.Html5QrcodeScanner);
        const res = {
          html5QrcodeLoaded: ok,
          src: window.__h5_src || '(unknown)',
          error: window.__h5_err || null,
          userAgent: navigator.userAgent,
          time: new Date().toISOString()
        };
        diag.textContent = JSON.stringify(res, null, 2);
        alert(ok ? 'html5-qrcode èª­è¾¼OK' : 'html5-qrcode ãŒèª­ã¿è¾¼ã‚ã¦ã„ã¾ã›ã‚“');
      };

      // â‘¢ ã‚«ãƒ¡ãƒ©æ¨©é™ãƒã‚§ãƒƒã‚¯ï¼ˆä»»æ„ï¼‰
      document.getElementById('btnCam').onclick = async () => {
        const res = { ok:false, error:null };
        try {
          const stream = await navigator.mediaDevices.getUserMedia({ video: true });
          res.ok = true;
          stream.getTracks().forEach(t => t.stop());
        } catch(e){ res.error = String(e); }
        diag.textContent = JSON.stringify(res, null, 2);
        alert(res.ok ? 'ã‚«ãƒ¡ãƒ©åˆ©ç”¨OK' : 'ã‚«ãƒ¡ãƒ©ãŒä½¿ãˆã¾ã›ã‚“: ' + res.error);
      };

      // â‘£ å¼·åˆ¶å†èª­è¾¼ï¼ˆã‚­ãƒ£ãƒƒã‚·ãƒ¥ç„¡è¦–ï¼‰
      document.getElementById('btnReload').onclick = () => {
        location.replace(location.pathname + '?t=' + Date.now());
      };
    });
  </script>
</head>
<body>
  <div class="badge">SEARCH SETUP OKï¼ˆç¢ºèªç”¨ãƒŸãƒ‹ãƒãƒ ç‰ˆï¼‰</div>

  <h1>å•†å“æ¤œç´¢ï¼ˆç¢ºèªç”¨ï¼‰</h1>
  <p>ã¾ãšã¯ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆãŒæ­£ã—ãèª­ã‚ã¦ã„ã‚‹ã‹ã€ãã—ã¦ã‚¹ã‚­ãƒ£ãƒ³ç”¨ãƒ©ã‚¤ãƒ–ãƒ©ãƒªãŒèª­è¾¼ã‚ã‚‹ã‹ã ã‘ç¢ºèªã—ã¾ã™ã€‚</p>

  <div class="card">
    <button class="btn" id="btnCheckJs">â‘  JSå‹•ä½œç¢ºèª</button>
    <button class="btn" id="btnCheckLib">â‘¡ ãƒ©ã‚¤ãƒ–ãƒ©ãƒªèª­è¾¼ç¢ºèªï¼ˆhtml5-qrcodeï¼‰</button>
    <button class="btn" id="btnCam">â‘¢ ã‚«ãƒ¡ãƒ©æ¨©é™ãƒã‚§ãƒƒã‚¯</button>
    <button class="btn" id="btnReload">â‘£ å¼·åˆ¶å†èª­è¾¼</button>
    <pre id="diag">{}</pre>
  </div>

  <div class="card" style="margin-top:16px">
    <input type="text" placeholder="ä¾‹: 4988001234567 / Switch ãªã©" style="width:70%;padding:.6em;border:1px solid #e5e7eb;border-radius:10px;">
    <button class="btn">ğŸ” æ¤œç´¢</button>
  </div>
</body>
</html>{% endraw %}

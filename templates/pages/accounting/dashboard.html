{% extends "base/layout.html" %}
{% block title %}ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ | ãƒªã‚µãƒ¼ãƒãƒŠãƒ“{% endblock %}
{% block content %}

<h1>ğŸ“Š ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰</h1>
<p class="muted">å£²ä¸Šãƒ»åˆ©ç›Šãƒ»åœ¨åº«ãƒ»é€šçŸ¥ã‚’ä¸€ç›®ã§ç¢ºèªã§ãã¾ã™ï¼ˆæ—¥æœ¬æ™‚é–“ãƒ™ãƒ¼ã‚¹ï¼‰ã€‚</p>

<div class="grid-2">
  <section class="card">
    <h3>æœ¬æ—¥å£²ä¸Šãƒ»åˆ©ç›Š</h3>
    <div class="kpi-row">
      <div class="kpi">
        <div class="kpi-label">æœ¬æ—¥å£²ä¸Š</div>
        <div class="kpi-value">Â¥{{ "{:,.0f}".format(today_sales) }}</div>
      </div>
      <div class="kpi">
        <div class="kpi-label">æœ¬æ—¥åˆ©ç›Š</div>
        <div class="kpi-value">Â¥{{ "{:,.0f}".format(today_profit) }}</div>
      </div>
    </div>
  </section>

  <section class="card">
    <h3>ä»Šæœˆå£²ä¸Šãƒ»åˆ©ç›Š</h3>
    <div class="kpi-row">
      <div class="kpi">
        <div class="kpi-label">ä»Šæœˆå£²ä¸Š</div>
        <div class="kpi-value">Â¥{{ "{:,.0f}".format(monthly_sales) }}</div>
      </div>
      <div class="kpi">
        <div class="kpi-label">ä»Šæœˆåˆ©ç›Š</div>
        <div class="kpi-value">Â¥{{ "{:,.0f}".format(monthly_profit) }}</div>
      </div>
    </div>
  </section>
</div>

<section class="card">
  <h3>ç›´è¿‘7æ—¥ã®å£²ä¸Šæ¨ç§»</h3>
  <canvas id="salesChart" height="120"></canvas>
</section>

<div class="grid-2 mt-16">
  <section class="card">
    <h3>åœ¨åº«ãƒˆãƒƒãƒ—5</h3>
    <table class="table">
      <thead>
        <tr>
          <th>å•†å“å</th>
          <th>åœ¨åº«æ•°</th>
          <th>ã‚«ãƒ†ã‚´ãƒª</th>
        </tr>
      </thead>
      <tbody>
        {% for row in stock_df.itertuples() %}
        <tr>
          <td>{{ row.item }}</td>
          <td>{{ row.stock }}</td>
          <td>{{ row.category }}</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </section>

  <section class="card">
    <h3>æœ€æ–°ã‚¢ãƒ©ãƒ¼ãƒˆ</h3>
    <ul class="alerts">
      {% for a in alert_df.itertuples() %}
      <li>
        <span class="badge">{{ a.level }}</span>
        {{ a.message }}
        <small class="muted">({{ a.date }})</small>
      </li>
      {% else %}
      <li class="muted">ã‚¢ãƒ©ãƒ¼ãƒˆã¯ã‚ã‚Šã¾ã›ã‚“ã€‚</li>
      {% endfor %}
    </ul>
  </section>
</div>

<script>
// Chart.js simple line chart
const ctx = document.getElementById('salesChart').getContext('2d');
const salesChart = new Chart(ctx, {
  type: 'line',
  data: {
    labels: {{ chart_labels|tojson }},
    datasets: [{
      label: 'å£²ä¸Š (å††)',
      data: {{ chart_values|tojson }},
      tension: 0.3,
      fill: false
    }]
  },
  options: {
    responsive: true,
    interaction: { mode: 'index', intersect: false },
    plugins: {
      legend: { display: true }
    },
    scales: {
      y: { beginAtZero: true }
    }
  }
});
</script>

{% endblock %}

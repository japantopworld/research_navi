{% extends "base/layout.html" %}
{% block title %}履歴一覧 | リサーチナビ{% endblock %}
{% block content %}

<h1>履歴一覧</h1>

<div class="toolbar">
  <a class="btn" href="{{ url_for('export_history') }}">CSVエクスポート</a>
</div>

{% if rows and rows|length %}
  <div class="table-wrap">
    <table class="table">
      <thead>
        <tr>
          <th>日時</th>
          <th>商品名</th>
          <th>PF</th>
          <th class="num">販売</th>
          <th class="num">仕入</th>
          <th class="num">送料</th>
          <th class="num">手数料</th>
          <th class="num">利益</th>
          <th class="num">利益率</th>
        </tr>
      </thead>
      <tbody>
        {% for r in rows %}
        <tr>
          <td>{{ r.created_at.strftime("%Y-%m-%d %H:%M") }}</td>
          <td>{{ r.name }}</td>
          <td>{{ r.platform }}</td>
          <td class="num">{{ r.price|yen }}</td>
          <td class="num">{{ r.cost|yen }}</td>
          <td class="num">{{ r.ship|yen }}</td>
          <td class="num">{{ r.fee|yen }}</td>
          <td class="num {% if r.profit>=0 %}pos{% else %}neg{% endif %}">{{ r.profit|yen }}</td>
          <td class="num">{{ r.margin }}%</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
{% else %}
  <p>まだ履歴がありません。まずは <a href="{{ url_for('profit') }}">利益計算</a> で登録してください。</p>
{% endif %}

<style>
.toolbar{margin:8px 0 12px}
.btn{display:inline-block;padding:8px 12px;border:1px solid #e5e7eb;border-radius:10px;background:#fff;text-decoration:none;color:#111}
.btn:hover{border-color:#cbd5e1;box-shadow:0 1px 4px rgba(0,0,0,.06)}

.table-wrap{overflow:auto;border:1px solid #e5e7eb;border-radius:10px}
.table{width:100%;border-collapse:collapse;background:#fff}
.table th,.table td{padding:10px;border-bottom:1px solid #f1f5f9;white-space:nowrap}
.table thead th{position:sticky;top:0;background:#f8fafc;font-weight:700}
.table .num{text-align:right}
.pos{color:#0a7f20;font-weight:600}
.neg{color:#b91c1c;font-weight:600}
</style>

{% endblock %}

{% extends "base/layout.html" %}
{% block title %}仕入れ先 | リサーチナビ{% endblock %}
{% block content %}

<h1>仕入れ先（ワンクリック検索）</h1>

<div class="card">
  <div class="grid">
    <label class="col">
      <span>キーワード</span>
      <input id="kw" type="text" placeholder="例：Switch 有機EL / iPad 64GB / ルンバ j7+">
    </label>
    <label class="col">
      <span>JAN / ISBN / ASIN（任意）</span>
      <input id="code" type="text" placeholder="例：4902370550501 / B0CXXXXX">
    </label>
    <label class="col">
      <span>条件</span>
      <select id="cond">
        <option value="">すべて</option>
        <option value="新品">新品</option>
        <option value="中古">中古</option>
      </select>
    </label>
  </div>

  <div class="actions">
    <button id="openSelected">選択したサイトで一括検索</button>
    <button id="clear" class="secondary">クリア</button>
  </div>
</div>

<div class="groups">

  <!-- 大手EC -->
  <section class="group">
    <h2>大手ECモール</h2>
    <div class="sites">
      <label><input type="checkbox" class="site" data-id="amazon"> 🅰️ Amazon（新品）</label>
      <label><input type="checkbox" class="site" data-id="rakuten"> ♨️ 楽天市場</label>
      <label><input type="checkbox" class="site" data-id="yahoo"> 🟡 ヤフーショッピング</label>
      <label><input type="checkbox" class="site" data-id="kakaku"> 📊 価格.com</label>
    </div>
    <div class="buttons">
      <a class="btn" data-id="amazon">Amazon</a>
      <a class="btn" data-id="rakuten">楽天</a>
      <a class="btn" data-id="yahoo">ヤフショ</a>
      <a class="btn" data-id="kakaku">価格.com</a>
    </div>
  </section>

  <!-- フリマ/オークション -->
  <section class="group">
    <h2>フリマ / オークション</h2>
    <div class="sites">
      <label><input type="checkbox" class="site" data-id="mercari"> 🟥 メルカリ</label>
      <label><input type="checkbox" class="site" data-id="paypayflea"> 🟡 PayPayフリマ</label>
      <label><input type="checkbox" class="site" data-id="yafuoku"> ⛳ ヤフオク!</label>
      <label><input type="checkbox" class="site" data-id="rakuma"> 🟣 ラクマ</label>
    </div>
    <div class="buttons">
      <a class="btn" data-id="mercari">メルカリ</a>
      <a class="btn" data-id="paypayflea">PayPayフリマ</a>
      <a class="btn" data-id="yafuoku">ヤフオク!</a>
      <a class="btn" data-id="rakuma">ラクマ</a>
    </div>
  </section>

  <!-- 家電量販オンライン -->
  <section class="group">
    <h2>家電量販オンライン</h2>
    <div class="sites">
      <label><input type="checkbox" class="site" data-id="yodobashi"> 🟦 ヨドバシ</label>
      <label><input type="checkbox" class="site" data-id="bic"> 🟥 ビックカメラ</label>
      <label><input type="checkbox" class="site" data-id="nojima"> 🟩 ノジマ</label>
      <label><input type="checkbox" class="site" data-id="edion"> 🔵 エディオン</label>
      <label><input type="checkbox" class="site" data-id="joshin"> 🟠 Joshin</label>
    </div>
    <div class="buttons">
      <a class="btn" data-id="yodobashi">ヨドバシ</a>
      <a class="btn" data-id="bic">ビック</a>
      <a class="btn" data-id="nojima">ノジマ</a>
      <a class="btn" data-id="edion">エディオン</a>
      <a class="btn" data-id="joshin">Joshin</a>
    </div>
  </section>

  <!-- 玩具/日用品/工具など -->
  <section class="group">
    <h2>玩具/日用品/工具 ほか</h2>
    <div class="sites">
      <label><input type="checkbox" class="site" data-id="toysrus"> 🧸 トイザらス</label>
      <label><input type="checkbox" class="site" data-id="lohaco"> 🧻 LOHACO</label>
      <label><input type="checkbox" class="site" data-id="monotaro"> 🛠️ MonotaRO</label>
      <label><input type="checkbox" class="site" data-id="surugaya"> 💿 駿河屋</label>
    </div>
    <div class="buttons">
      <a class="btn" data-id="toysrus">トイザらス</a>
      <a class="btn" data-id="lohaco">LOHACO</a>
      <a class="btn" data-id="monotaro">MonotaRO</a>
      <a class="btn" data-id="surugaya">駿河屋</a>
    </div>
  </section>

  <!-- 参考＆外部ツール -->
  <section class="group">
    <h2>参考リンク（任意・ログイン要の可能性あり）</h2>
    <div class="sites">
      <label><input type="checkbox" class="site" data-id="keepa"> 📈 Keepa（ASIN）</label>
      <label><input type="checkbox" class="site" data-id="camel"> 🐪 CamelCamel（ASIN）</label>
      <label><input type="checkbox" class="site" data-id="google"> 🔎 Googleショッピング</label>
    </div>
    <div class="buttons">
      <a class="btn" data-id="keepa">Keepa</a>
      <a class="btn" data-id="camel">Camel</a>
      <a class="btn" data-id="google">Google</a>
    </div>
  </section>

</div>

<style>
.card{border:1px solid #e5e7eb;border-radius:12px;background:#fff;padding:16px;margin:10px 0}
.grid{display:grid;gap:12px;grid-template-columns:1fr 1fr 1fr}
.col{display:flex;flex-direction:column;gap:6px}
.col span{font-size:12px;color:#6b7280}
input,select{padding:8px;border:1px solid #e5e7eb;border-radius:8px;background:#fff}
.actions{display:flex;gap:8px;margin-top:12px;flex-wrap:wrap}
button{padding:10px 14px;border:1px solid #e5e7eb;border-radius:8px;background:#111;color:#fff;cursor:pointer}
button.secondary{background:#fff;color:#111}

.groups{display:grid;gap:16px;margin-top:12px}
.group{border:1px solid #e5e7eb;border-radius:12px;background:#fff;padding:12px}
.group h2{margin:0 0 8px;font-size:16px}
.sites{display:flex;flex-wrap:wrap;gap:10px;margin-bottom:8px}
.sites label{display:flex;gap:6px;align-items:center;border:1px solid #e5e7eb;border-radius:999px;padding:6px 10px;background:#fff;cursor:pointer}
.buttons{display:flex;flex-wrap:wrap;gap:8px}
a.btn{display:inline-block;padding:8px 12px;border:1px solid #e5e7eb;border-radius:10px;background:#f8fafc;color:#111;text-decoration:none;cursor:pointer}
a.btn:hover{border-color:#cbd5e1}

@media (max-width:980px){.grid{grid-template-columns:1fr 1fr}}
@media (max-width:640px){.grid{grid-template-columns:1fr}}
</style>

<script>
(() => {
  const $  = (q)=>document.querySelector(q);
  const $$ = (q)=>Array.from(document.querySelectorAll(q));

  const kw    = $('#kw');
  const code  = $('#code');
  const cond  = $('#cond');

  // サイトごとの検索URLを定義（{q}=キーワード、{c}=コード）
  const URLS = {
    // 大手EC
    amazon:    q => `https://www.amazon.co.jp/s?k=${encodeURIComponent(q)}`,
    rakuten:   q => `https://search.rakuten.co.jp/search/mall/${encodeURIComponent(q)}/`,
    yahoo:     q => `https://shopping.yahoo.co.jp/search?p=${encodeURIComponent(q)}`,
    kakaku:    q => `https://kakaku.com/search_results/${encodeURIComponent(q)}/`,

    // フリマ/オク
    mercari:   q => `https://www.mercari.com/jp/search/?keyword=${encodeURIComponent(q)}`,
    paypayflea:q => `https://paypayfleamarket.yahoo.co.jp/search/%E6%A4%9C%E7%B4%A2?query=${encodeURIComponent(q)}`,
    yafuoku:   q => `https://auctions.yahoo.co.jp/search/search?p=${encodeURIComponent(q)}`,
    rakuma:    q => `https://fril.jp/s?query=${encodeURIComponent(q)}`,

    // 家電量販
    yodobashi: q => `https://www.yodobashi.com/?word=${encodeURIComponent(q)}`,
    bic:       q => `https://www.biccamera.com/bc/item/?q=${encodeURIComponent(q)}`,
    nojima:    q => `https://online.nojima.co.jp/app/catalog/list/init?searchMethod=2&searchText=${encodeURIComponent(q)}`,
    edion:     q => `https://www.edion.com/Search?keyword=${encodeURIComponent(q)}`,
    joshin:    q => `https://joshinweb.jp/search/?key=${encodeURIComponent(q)}`,

    // 玩具/日用品/工具
    toysrus:   q => `https://www.toysrus.co.jp/search/?q=${encodeURIComponent(q)}`,
    lohaco:    q => `https://lohaco.yahoo.co.jp/search/?p=${encodeURIComponent(q)}`,
    monotaro:  q => `https://www.monotaro.com/s/?f.keyword=${encodeURIComponent(q)}`,
    surugaya:  q => `https://www.suruga-ya.jp/search?category=&search_word=${encodeURIComponent(q)}`,

    // 参考ツール
    keepa:   _ => code.value ? `https://keepa.com/#!product/5-${encodeURIComponent(code.value)}` : '',
    camel:   _ => code.value ? `https://camelcamelcamel.com/search?sq=${encodeURIComponent(code.value)}` : '',
    google:  q => `https://www.google.com/search?tbm=shop&q=${encodeURIComponent(q)}`
  };

  // 条件（新品/中古）を簡易的にキーワードへ反映
  function buildQuery() {
    const base = (kw.value || '').trim();
    const c = (code.value || '').trim();
    const tag = cond.value ? ` ${cond.value}` : '';
    // コードがあれば付加（メルカリなどでも引っかかる）
    return (c ? `${base} ${c}${tag}`.trim() : `${base}${tag}`.trim());
  }

  function openSite(id){
    const q = buildQuery();
    if(!q){ alert('キーワードを入力してください'); return; }
    const fn = URLS[id];
    if(!fn){ return; }
    const url = fn(q);
    if(!url){ alert('そのサイトはコード（ASIN/JAN）が必要です'); return; }
    window.open(url, '_blank');
  }

  // 各ボタン：単発オープン
  $$('.buttons .btn').forEach(btn=>{
    btn.addEventListener('click', e=>{
      e.preventDefault();
      const id = btn.dataset.id;
      openSite(id);
    });
  });

  // 一括オープン
  $('#openSelected').addEventListener('click', ()=>{
    const selected = $$('.sites .site:checked').map(x=>x.dataset.id);
    if(selected.length===0){ alert('サイトを選択してください'); return; }
    const q = buildQuery();
    if(!q){ alert('キーワードを入力してください'); return; }
    for(const id of selected){
      const fn = URLS[id];
      if(!fn) continue;
      const url = fn(q);
      if(!url) continue;
      window.open(url, '_blank');
    }
  });

  // クリア
  $('#clear').addEventListener('click', ()=>{
    kw.value = ''; code.value = ''; cond.value = '';
    $$('.sites .site').forEach(x=>x.checked = false);
    kw.focus();
  });

  // Enterで一括オープン
  kw.addEventListener('keydown', e=>{
    if(e.key === 'Enter'){ e.preventDefault(); $('#openSelected').click(); }
  });
})();
</script>

{% endblock %}

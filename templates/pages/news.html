{% extends "base/layout.html" %}
{% block title %}ğŸ“¥ ãƒ¡ãƒ¼ãƒ«ãƒœãƒƒã‚¯ã‚¹{% endblock %}
{% block content %}

<h2>ğŸ“¥ {{ user_id }} ã•ã‚“ã®ãƒ¡ãƒ¼ãƒ«ãƒœãƒƒã‚¯ã‚¹</h2>

<!-- â–¼ ã‚¿ãƒ–åˆ‡ã‚Šæ›¿ãˆ -->
<div class="tabs">
  <a href="{{ url_for('news', tab='inbox') }}" class="tab {{ 'active' if tab=='inbox' else '' }}">ğŸ“¥ å—ä¿¡ãƒœãƒƒã‚¯ã‚¹</a>
  <a href="{{ url_for('news', tab='sent') }}" class="tab {{ 'active' if tab=='sent' else '' }}">ğŸ“¤ é€ä¿¡ãƒœãƒƒã‚¯ã‚¹</a>
  <a href="{{ url_for('news', tab='compose') }}" class="tab {{ 'active' if tab=='compose' else '' }}">âœ‰ï¸ æ–°è¦ä½œæˆ</a>
</div>

<!-- â–¼ å—ä¿¡ãƒœãƒƒã‚¯ã‚¹ -->
{% if tab == "inbox" %}
  {% if messages %}
  <table class="inbox">
    <tr><th>é€ä¿¡è€…</th><th>ä»¶å</th><th>æ—¥æ™‚</th><th>çŠ¶æ…‹</th></tr>
    {% for m in messages %}
      <tr class="{{ 'unread' if m['ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹']=='æœªèª­' else 'read' }}">
        <td>{{ m["é€ä¿¡è€…"] }}</td>
        <td>{{ m["ä»¶å"] }}</td>
        <td>{{ m["é€ä¿¡æ—¥æ™‚"] }}</td>
        <td>{{ m["ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹"] }}</td>
      </tr>
    {% endfor %}
  </table>
  {% else %}
  <p>ğŸ“­ ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã¯ã¾ã ã‚ã‚Šã¾ã›ã‚“ã€‚</p>
  {% endif %}

<!-- â–¼ é€ä¿¡ãƒœãƒƒã‚¯ã‚¹ -->
{% elif tab == "sent" %}
  {% if messages %}
  <table class="inbox">
    <tr><th>å®›å…ˆ</th><th>ä»¶å</th><th>æ—¥æ™‚</th></tr>
    {% for m in messages %}
      <tr>
        <td>{{ m["å®›å…ˆ"] }}</td>
        <td>{{ m["ä»¶å"] }}</td>
        <td>{{ m["é€ä¿¡æ—¥æ™‚"] }}</td>
      </tr>
    {% endfor %}
  </table>
  {% else %}
  <p>ğŸ“­ é€ä¿¡æ¸ˆã¿ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã¯ã¾ã ã‚ã‚Šã¾ã›ã‚“ã€‚</p>
  {% endif %}

<!-- â–¼ æ–°è¦ä½œæˆ -->
{% elif tab == "compose" %}
  <form method="POST" action="{{ url_for('send_message') }}" enctype="multipart/form-data" class="compose-form">
    <label>å®›å…ˆID:</label>
    <input type="text" name="receiver" required>

    <label>ä»¶å:</label>
    <input type="text" name="subject" required>

    <label>æœ¬æ–‡:</label>
    <textarea name="body" rows="5" required></textarea>

    <label>æ·»ä»˜ãƒ•ã‚¡ã‚¤ãƒ«:</label>
    <input type="file" name="attachment">

    <button type="submit" class="btn-submit">ğŸ“¤ é€ä¿¡</button>
  </form>
{% endif %}

<!-- â–¼ ã‚¹ã‚¿ã‚¤ãƒ« -->
<style>
.tabs {
  margin: 1rem 0;
  display: flex;
  gap: 1rem;
}
.tab {
  padding: 0.6rem 1.2rem;
  border-radius: 0.5rem;
  background: #e5e7eb;
  text-decoration: none;
  color: #333;
  font-weight: bold;
}
.tab.active {
  background: #dc2626;
  color: #fff;
}
.inbox {
  width:100%;
  border-collapse: collapse;
  margin-top:1rem;
}
.inbox th, .inbox td {
  border:1px solid #ddd;
  padding:8px;
}
.inbox .unread {
  background:#fff;
  color:#dc2626;
  font-weight:700;
}
.inbox .read {
  background:#f3f4f6;
  color:#555;
}

/* æ–°è¦ä½œæˆãƒ•ã‚©ãƒ¼ãƒ ã‚’ä¸­å¤®å¯„ã› */
.compose-form {
  max-width: 600px;
  margin: 2rem auto;
  padding: 2rem;
  background: #fff;
  border-radius: 0.8rem;
  box-shadow: 0 0 10px rgba(0,0,0,0.1);
  display: flex;
  flex-direction: column;
  gap: 1rem;
}
.compose-form label {
  font-weight: bold;
}
.compose-form input, 
.compose-form textarea {
  width: 100%;
  padding: 0.6rem;
  border: 1px solid #ddd;
  border-radius: 0.5rem;
}
.btn-submit {
  background: #dc2626;
  color: #fff;
  font-weight: bold;
  padding: 0.8rem;
  border: none;
  border-radius: 0.5rem;
  cursor: pointer;
}
.btn-submit:hover {
  opacity: 0.9;
}
</style>

{% endblock %}

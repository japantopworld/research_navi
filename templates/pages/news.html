{% extends "base/layout.html" %}
{% block title %}ğŸ“¥ ãƒ¡ãƒ¼ãƒ«ãƒœãƒƒã‚¯ã‚¹{% endblock %}
{% block content %}

<h2 style="text-align:center;">ğŸ“¬ {{ user_id }} ã•ã‚“ã®ãƒ¡ãƒ¼ãƒ«ãƒœãƒƒã‚¯ã‚¹</h2>

<!-- ã‚¿ãƒ–ãƒœã‚¿ãƒ³ -->
<div class="tabs">
  <a href="{{ url_for('news', tab='inbox') }}" class="tab {% if tab=='inbox' %}active{% endif %}">ğŸ“¥ å—ä¿¡</a>
  <a href="{{ url_for('news', tab='sent') }}" class="tab {% if tab=='sent' %}active{% endif %}">ğŸ“¤ é€ä¿¡</a>
  <a href="{{ url_for('news', tab='compose') }}" class="tab {% if tab=='compose' %}active{% endif %}">âœ æ–°è¦</a>
</div>

<!-- â–¼ å—ä¿¡ / é€ä¿¡ å…±é€šãƒªã‚¹ãƒˆ -->
{% if tab in ['inbox','sent'] %}
  <form method="POST">
    <table class="inbox">
      <tr>
        {% if tab == 'inbox' %}
          <th>âœ”</th>
        {% endif %}
        <th>é€ä¿¡è€…</th><th>å®›å…ˆ</th><th>ä»¶å</th><th>æ—¥æ™‚</th><th>çŠ¶æ…‹</th>
      </tr>
      {% for m in messages %}
        <tr class="{{ 'unread' if m['ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹']=='æœªèª­' else 'read' }}">
          {% if tab == 'inbox' %}
            <td><input type="checkbox" name="msg_ids" value="{{ m['ID'] }}"></td>
          {% endif %}
          <td>{{ m["é€ä¿¡è€…"] }}</td>
          <td>{{ m["å®›å…ˆ"] }}</td>
          <td>
            <a href="{{ url_for('news_detail', msg_id=m['ID']) }}">
              {{ m["ä»¶å"] }}
            </a>
          </td>
          <td>{{ m["é€ä¿¡æ—¥æ™‚"] }}</td>
          <td>{{ m["ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹"] }}</td>
        </tr>
      {% endfor %}
      {% if messages|length == 0 %}
        <tr><td colspan="6" style="text-align:center;">ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã¯ã‚ã‚Šã¾ã›ã‚“</td></tr>
      {% endif %}
    </table>
    {% if tab == 'inbox' and messages|length > 0 %}
      <div class="bulk-actions">
        <button type="submit">âœ” é¸æŠã—ãŸãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’æ—¢èª­ã«ã™ã‚‹</button>
      </div>
    {% endif %}
  </form>
{% endif %}

<!-- â–¼ æ–°è¦ä½œæˆãƒ•ã‚©ãƒ¼ãƒ  -->
{% if tab == 'compose' %}
  <form method="POST" class="compose-form">
    <label>å®›å…ˆID:</label>
    <input type="text" name="to" required>
    <label>ä»¶å:</label>
    <input type="text" name="subject" required>
    <label>æœ¬æ–‡:</label>
    <textarea name="body" rows="6" required></textarea>
    <button type="submit">ğŸ“¨ é€ä¿¡</button>
  </form>
{% endif %}

<style>
  h2 { margin: 1rem 0; }
  .tabs {
    display: flex;
    justify-content: center;
    gap: 1rem;
    margin-bottom: 1rem;
  }
  .tab {
    padding: .6rem 1.2rem;
    border-radius: .6rem;
    text-decoration: none;
    font-weight: bold;
    background: #f3f4f6;
    color: #333;
  }
  .tab.active {
    background: #dc2626;
    color: #ffeb3b;
  }
  .inbox { width:90%; margin:0 auto; border-collapse: collapse; }
  .inbox th, .inbox td { border:1px solid #ddd; padding:8px; text-align:center; }
  .inbox .unread { background:#fff; color:#dc2626; font-weight:700; }
  .inbox .read { background:#f9fafb; color:#555; }
  .inbox a { color:inherit; text-decoration:underline; }
  .compose-form {
    display: flex;
    flex-direction: column;
    gap: .8rem;
    width: 70%;
    margin: 1rem auto;
  }
  .compose-form input, .compose-form textarea {
    padding: .6rem;
    border-radius: .4rem;
    border:1px solid #ddd;
  }
  .compose-form button {
    padding: .6rem;
    border:none;
    border-radius:.6rem;
    background:#dc2626;
    color:#ffeb3b;
    font-weight:bold;
    cursor:pointer;
  }
  .compose-form button:hover { opacity:.9; }
  .bulk-actions {
    text-align: right;
    width: 90%;
    margin: 0.5rem auto;
  }
  .bulk-actions button {
    padding: .4rem .8rem;
    border:none;
    border-radius:.4rem;
    background:#2563eb;
    color:#fff;
    font-weight:bold;
    cursor:pointer;
  }
  .bulk-actions button:hover { opacity:.9; }
</style>

{% endblock %}

{% extends "base/layout.html" %}
{% block title %}📥 メールボックス{% endblock %}
{% block content %}

<h2>📥 {{ user_id }} さんのメールボックス</h2>

<!-- ▼ タブ切り替え -->
<div class="tabs">
  <a href="{{ url_for('news', tab='inbox') }}" class="tab {{ 'active' if tab=='inbox' else '' }}">📥 受信ボックス</a>
  <a href="{{ url_for('news', tab='sent') }}" class="tab {{ 'active' if tab=='sent' else '' }}">📤 送信ボックス</a>
  <a href="{{ url_for('news', tab='compose') }}" class="tab {{ 'active' if tab=='compose' else '' }}">✉️ 新規作成</a>
</div>

<!-- ▼ 受信ボックス -->
{% if tab == "inbox" %}
  {% if messages %}
  <table class="inbox">
    <tr><th>送信者</th><th>件名</th><th>日時</th><th>状態</th></tr>
    {% for m in messages %}
      <tr class="{{ 'unread' if m['ステータス']=='未読' else 'read' }}">
        <td>{{ m["送信者"] }}</td>
        <td>{{ m["件名"] }}</td>
        <td>{{ m["送信日時"] }}</td>
        <td>{{ m["ステータス"] }}</td>
      </tr>
    {% endfor %}
  </table>
  {% else %}
  <p>📭 メッセージはまだありません。</p>
  {% endif %}

<!-- ▼ 送信ボックス -->
{% elif tab == "sent" %}
  {% if messages %}
  <table class="inbox">
    <tr><th>宛先</th><th>件名</th><th>日時</th></tr>
    {% for m in messages %}
      <tr>
        <td>{{ m["宛先"] }}</td>
        <td>{{ m["件名"] }}</td>
        <td>{{ m["送信日時"] }}</td>
      </tr>
    {% endfor %}
  </table>
  {% else %}
  <p>📭 送信済みメッセージはまだありません。</p>
  {% endif %}

<!-- ▼ 新規作成 -->
{% elif tab == "compose" %}
  <form method="POST" action="{{ url_for('send_message') }}" enctype="multipart/form-data" class="compose-form">
    <label>宛先ID:</label>
    <input type="text" name="receiver" required>

    <label>件名:</label>
    <input type="text" name="subject" required>

    <label>本文:</label>
    <textarea name="body" rows="5" required></textarea>

    <label>添付ファイル:</label>
    <input type="file" name="attachment">

    <button type="submit" class="btn-submit">📤 送信</button>
  </form>
{% endif %}

<!-- ▼ スタイル -->
<style>
.tabs {
  margin: 1rem 0;
  display: flex;
  gap: 1rem;
}
.tab {
  padding: 0.6rem 1.2rem;
  border-radius: 0.5rem;
  background: #e5e7eb;
  text-decoration: none;
  color: #333;
  font-weight: bold;
}
.tab.active {
  background: #dc2626;
  color: #fff;
}
.inbox {
  width:100%;
  border-collapse: collapse;
  margin-top:1rem;
}
.inbox th, .inbox td {
  border:1px solid #ddd;
  padding:8px;
}
.inbox .unread {
  background:#fff;
  color:#dc2626;
  font-weight:700;
}
.inbox .read {
  background:#f3f4f6;
  color:#555;
}

/* 新規作成フォームを中央寄せ */
.compose-form {
  max-width: 600px;
  margin: 2rem auto;
  padding: 2rem;
  background: #fff;
  border-radius: 0.8rem;
  box-shadow: 0 0 10px rgba(0,0,0,0.1);
  display: flex;
  flex-direction: column;
  gap: 1rem;
}
.compose-form label {
  font-weight: bold;
}
.compose-form input, 
.compose-form textarea {
  width: 100%;
  padding: 0.6rem;
  border: 1px solid #ddd;
  border-radius: 0.5rem;
}
.btn-submit {
  background: #dc2626;
  color: #fff;
  font-weight: bold;
  padding: 0.8rem;
  border: none;
  border-radius: 0.5rem;
  cursor: pointer;
}
.btn-submit:hover {
  opacity: 0.9;
}
</style>

{% endblock %}

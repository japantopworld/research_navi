{% extends "base/layout.html" %}
{% block title %}ğŸ“¥ ãƒ¡ãƒ¼ãƒ«ãƒœãƒƒã‚¯ã‚¹{% endblock %}
{% block content %}

<h2 style="text-align:center;">ğŸ“¬ {{ user_id }} ã•ã‚“ã®ãƒ¡ãƒ¼ãƒ«ãƒœãƒƒã‚¯ã‚¹</h2>

<!-- ã‚¿ãƒ– -->
<div class="tabs">
  <a href="{{ url_for('news', tab='inbox') }}" class="tab {% if tab=='inbox' %}active{% endif %}">
    ğŸ“¥ å—ä¿¡
    {% if unread_count > 0 %}
      <span class="badge">{{ unread_count }}</span>
    {% endif %}
  </a>
  <a href="{{ url_for('news', tab='sent') }}" class="tab {% if tab=='sent' %}active{% endif %}">ğŸ“¤ é€ä¿¡</a>
  <a href="{{ url_for('news', tab='compose') }}" class="tab {% if tab=='compose' %}active{% endif %}">âœ æ–°è¦</a>
</div>

<!-- ğŸ” æ¤œç´¢ãƒ•ã‚©ãƒ¼ãƒ  -->
{% if tab in ['inbox', 'sent'] %}
<form method="GET" style="text-align:center; margin:1rem;">
  <input type="hidden" name="tab" value="{{ tab }}">
  <input type="text" name="q" placeholder="ä»¶åãƒ»æœ¬æ–‡ã§æ¤œç´¢" value="{{ request.args.get('q','') }}">
  <button type="submit">æ¤œç´¢</button>
</form>
{% endif %}

{% if tab == 'inbox' %}
<form method="POST">
  <table class="inbox">
    <tr>
      <th></th><th>é€ä¿¡è€…</th><th>ä»¶å</th><th>æ—¥æ™‚</th><th>çŠ¶æ…‹</th>
    </tr>
    {% for m in inbox %}
    <tr class="{{ 'unread' if m['ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹']=='æœªèª­' else 'read' }}">
      <td><input type="checkbox" name="msg_ids" value="{{ m['ID'] }}"></td>
      <td>{{ m["é€ä¿¡è€…"] }}</td>
      <td><a href="{{ url_for('news_detail', msg_id=m['ID']) }}">{{ m["ä»¶å"] }}</a></td>
      <td>{{ m["é€ä¿¡æ—¥æ™‚"] }}</td>
      <td>{{ m["ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹"] }}</td>
    </tr>
    {% endfor %}
  </table>
  <div class="actions">
    <button type="submit" name="action" value="mark_read">âœ… é¸æŠã‚’æ—¢èª­ã«</button>
    <button type="submit" name="action" value="delete" onclick="return confirm('æœ¬å½“ã«å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ')">ğŸ—‘ï¸ å‰Šé™¤</button>
  </div>
</form>
{% endif %}

{% if tab == 'sent' %}
<form method="POST">
  <table class="inbox">
    <tr><th></th><th>å®›å…ˆ</th><th>ä»¶å</th><th>æ—¥æ™‚</th><th>çŠ¶æ…‹</th></tr>
    {% for m in sent %}
    <tr>
      <td><input type="checkbox" name="msg_ids" value="{{ m['ID'] }}"></td>
      <td>{{ m["å®›å…ˆ"] }}</td>
      <td><a href="{{ url_for('news_detail', msg_id=m['ID']) }}">{{ m["ä»¶å"] }}</a></td>
      <td>{{ m["é€ä¿¡æ—¥æ™‚"] }}</td>
      <td>{{ m["ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹"] }}</td>
    </tr>
    {% endfor %}
  </table>
  <div class="actions">
    <button type="submit" name="action" value="delete" onclick="return confirm('æœ¬å½“ã«å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ')">ğŸ—‘ï¸ å‰Šé™¤</button>
  </div>
</form>
{% endif %}

{% if tab == 'compose' %}
<form method="POST" enctype="multipart/form-data" class="compose-form">
  <label>å®›å…ˆ:</label>
  <input type="text" name="to" value="{{ reply_to or '' }}" placeholder="ID ã¾ãŸã¯ @éƒ¨ç½²å" required>
  <label>ä»¶å:</label>
  <input type="text" name="subject" value="{{ reply_subject or '' }}" required>
  <label>æœ¬æ–‡:</label>
  <textarea name="body" rows="6" required></textarea>
  <label>æ·»ä»˜:</label>
  <input type="file" name="attach">
  <button type="submit">ğŸ“¨ é€ä¿¡</button>
</form>
{% endif %}

<style>
  .tabs { display:flex; justify-content:center; gap:1rem; margin:1rem 0; }
  .tab { padding:.6rem 1.2rem; border-radius:.6rem; text-decoration:none; font-weight:bold; background:#f3f4f6; color:#333; position:relative; }
  .tab.active { background:#dc2626; color:#ffeb3b; }
  .badge { background:#dc2626; color:#fff; border-radius:50%; padding:0.2rem 0.5rem; font-size:0.8rem; margin-left:0.3rem; }
  .inbox { width:90%; margin:0 auto; border-collapse:collapse; }
  .inbox th,.inbox td { border:1px solid #ddd; padding:8px; text-align:center; }
  .inbox .unread { background:#fff; color:#dc2626; font-weight:700; }
  .inbox .read { background:#f9fafb; color:#555; }
  .compose-form { width:70%; margin:1rem auto; display:flex; flex-direction:column; gap:.8rem; }
  .compose-form input,.compose-form textarea { padding:.6rem; border:1px solid #ddd; border-radius:.4rem; }
  .compose-form button { padding:.6rem; background:#dc2626; color:#ffeb3b; border:none; border-radius:.6rem; font-weight:bold; cursor:pointer; }
  .actions { text-align:center; margin:1rem; }
  .actions button { margin:0 .5rem; padding:.5rem 1rem; }
</style>

{% endblock %}

{% extends "base/layout.html" %}
{% block title %}📬 メールボックス{% endblock %}
{% block content %}

<h2>📬 {{ user_id }} さんのメールボックス</h2>

<!-- タブ切替 -->
<div class="tabs">
  <button class="tab-btn active" onclick="showTab('inbox')">📥 受信ボックス</button>
  <button class="tab-btn" onclick="showTab('sent')">📤 送信ボックス</button>
  <button class="tab-btn" onclick="showTab('compose')">✉️ 新規作成</button>
</div>

<!-- 受信ボックス -->
<div id="inbox" class="tab-content" style="display:block;">
  {% if inbox %}
  <table class="msg-table">
    <tr><th>送信者</th><th>件名</th><th>日時</th><th>状態</th></tr>
    {% for m in inbox %}
    <tr class="{{ 'unread' if m['ステータス']=='未読' else 'read' }}">
      <td>{{ m["送信者"] }}</td>
      <td>{{ m["件名"] }}</td>
      <td>{{ m["送信日時"] }}</td>
      <td>{{ m["ステータス"] }}</td>
    </tr>
    {% endfor %}
  </table>
  {% else %}
  <p>📭 メッセージはまだありません。</p>
  {% endif %}
</div>

<!-- 送信ボックス -->
<div id="sent" class="tab-content" style="display:none;">
  {% if sent %}
  <table class="msg-table">
    <tr><th>宛先</th><th>件名</th><th>日時</th></tr>
    {% for m in sent %}
    <tr>
      <td>{{ m["宛先"] }}</td>
      <td>{{ m["件名"] }}</td>
      <td>{{ m["送信日時"] }}</td>
    </tr>
    {% endfor %}
  </table>
  {% else %}
  <p>📭 送信済みメッセージはまだありません。</p>
  {% endif %}
</div>

<!-- 新規作成フォーム -->
<div id="compose" class="tab-content" style="display:none;">
  <form method="post" action="{{ url_for('send_message') }}" enctype="multipart/form-data" class="compose-form">
    <label>宛先ID:</label>
    <input type="text" name="receiver" required>

    <label>件名:</label>
    <input type="text" name="subject" required>

    <label>本文:</label>
    <textarea name="body" rows="6" required></textarea>

    <label>添付ファイル:</label>
    <input type="file" name="attachment">

    <button type="submit">📨 送信</button>
  </form>
</div>

<style>
  .tabs { margin:1rem 0; display:flex; gap:1rem; }
  .tab-btn {
    padding:0.6rem 1.2rem; border:none; border-radius:0.6rem;
    background:#e5e7eb; cursor:pointer; font-weight:bold;
  }
  .tab-btn.active { background:#dc2626; color:#fff; }
  .msg-table { width:100%; border-collapse: collapse; margin-top:1rem; }
  .msg-table th, .msg-table td { border:1px solid #ddd; padding:8px; }
  .msg-table .unread { background:#fff; color:#dc2626; font-weight:700; }
  .msg-table .read { background:#f3f4f6; color:#555; }
  .compose-form { display:flex; flex-direction:column; gap:0.8rem; max-width:600px; }
  .compose-form input, .compose-form textarea {
    padding:0.6rem; border:1px solid #ddd; border-radius:0.4rem;
  }
  .compose-form button {
    background:#dc2626; color:#fff; font-weight:bold;
    padding:0.8rem; border:none; border-radius:0.6rem;
  }
</style>

<script>
function showTab(tabId) {
  document.querySelectorAll('.tab-content').forEach(el => el.style.display = "none");
  document.querySelectorAll('.tab-btn').forEach(el => el.classList.remove("active"));
  document.getElementById(tabId).style.display = "block";
  event.target.classList.add("active");
}
</script>

{% endblock %}

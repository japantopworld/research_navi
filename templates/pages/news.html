{% extends "base/layout.html" %}
{% block title %}ğŸ“¬ ãƒ¡ãƒ¼ãƒ«ãƒœãƒƒã‚¯ã‚¹{% endblock %}
{% block content %}

<h2>ğŸ“¬ {{ user_id }} ã•ã‚“ã®ãƒ¡ãƒ¼ãƒ«ãƒœãƒƒã‚¯ã‚¹</h2>

<!-- ã‚¿ãƒ–åˆ‡æ›¿ -->
<div class="tabs">
  <button class="tab-btn active" onclick="showTab('inbox')">ğŸ“¥ å—ä¿¡ãƒœãƒƒã‚¯ã‚¹</button>
  <button class="tab-btn" onclick="showTab('sent')">ğŸ“¤ é€ä¿¡ãƒœãƒƒã‚¯ã‚¹</button>
  <button class="tab-btn" onclick="showTab('compose')">âœ‰ï¸ æ–°è¦ä½œæˆ</button>
</div>

<!-- å—ä¿¡ãƒœãƒƒã‚¯ã‚¹ -->
<div id="inbox" class="tab-content" style="display:block;">
  {% if inbox %}
  <table class="msg-table">
    <tr><th>é€ä¿¡è€…</th><th>ä»¶å</th><th>æ—¥æ™‚</th><th>çŠ¶æ…‹</th></tr>
    {% for m in inbox %}
    <tr class="{{ 'unread' if m['ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹']=='æœªèª­' else 'read' }}">
      <td>{{ m["é€ä¿¡è€…"] }}</td>
      <td>{{ m["ä»¶å"] }}</td>
      <td>{{ m["é€ä¿¡æ—¥æ™‚"] }}</td>
      <td>{{ m["ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹"] }}</td>
    </tr>
    {% endfor %}
  </table>
  {% else %}
  <p>ğŸ“­ ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã¯ã¾ã ã‚ã‚Šã¾ã›ã‚“ã€‚</p>
  {% endif %}
</div>

<!-- é€ä¿¡ãƒœãƒƒã‚¯ã‚¹ -->
<div id="sent" class="tab-content" style="display:none;">
  {% if sent %}
  <table class="msg-table">
    <tr><th>å®›å…ˆ</th><th>ä»¶å</th><th>æ—¥æ™‚</th></tr>
    {% for m in sent %}
    <tr>
      <td>{{ m["å®›å…ˆ"] }}</td>
      <td>{{ m["ä»¶å"] }}</td>
      <td>{{ m["é€ä¿¡æ—¥æ™‚"] }}</td>
    </tr>
    {% endfor %}
  </table>
  {% else %}
  <p>ğŸ“­ é€ä¿¡æ¸ˆã¿ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã¯ã¾ã ã‚ã‚Šã¾ã›ã‚“ã€‚</p>
  {% endif %}
</div>

<!-- æ–°è¦ä½œæˆãƒ•ã‚©ãƒ¼ãƒ  -->
<div id="compose" class="tab-content" style="display:none;">
  <form method="post" action="{{ url_for('send_message') }}" enctype="multipart/form-data" class="compose-form">
    <label>å®›å…ˆID:</label>
    <input type="text" name="receiver" required>

    <label>ä»¶å:</label>
    <input type="text" name="subject" required>

    <label>æœ¬æ–‡:</label>
    <textarea name="body" rows="6" required></textarea>

    <label>æ·»ä»˜ãƒ•ã‚¡ã‚¤ãƒ«:</label>
    <input type="file" name="attachment">

    <button type="submit">ğŸ“¨ é€ä¿¡</button>
  </form>
</div>

<style>
  .tabs { margin:1rem 0; display:flex; gap:1rem; }
  .tab-btn {
    padding:0.6rem 1.2rem; border:none; border-radius:0.6rem;
    background:#e5e7eb; cursor:pointer; font-weight:bold;
  }
  .tab-btn.active { background:#dc2626; color:#fff; }
  .msg-table { width:100%; border-collapse: collapse; margin-top:1rem; }
  .msg-table th, .msg-table td { border:1px solid #ddd; padding:8px; }
  .msg-table .unread { background:#fff; color:#dc2626; font-weight:700; }
  .msg-table .read { background:#f3f4f6; color:#555; }
  .compose-form { display:flex; flex-direction:column; gap:0.8rem; max-width:600px; }
  .compose-form input, .compose-form textarea {
    padding:0.6rem; border:1px solid #ddd; border-radius:0.4rem;
  }
  .compose-form button {
    background:#dc2626; color:#fff; font-weight:bold;
    padding:0.8rem; border:none; border-radius:0.6rem;
  }
</style>

<script>
function showTab(tabId) {
  document.querySelectorAll('.tab-content').forEach(el => el.style.display = "none");
  document.querySelectorAll('.tab-btn').forEach(el => el.classList.remove("active"));
  document.getElementById(tabId).style.display = "block";
  event.target.classList.add("active");
}
</script>

{% endblock %}

{% extends "base/layout.html" %}
{% block title %}ä»•å…¥ã‚Œå…ˆ | ãƒªã‚µãƒ¼ãƒãƒŠãƒ“{% endblock %}
{% block content %}

<h1>ä»•å…¥ã‚Œå…ˆï¼ˆãƒ¯ãƒ³ã‚¯ãƒªãƒƒã‚¯æ¤œç´¢ï¼‰</h1>

<div class="card">
  <div class="grid">
    <label class="col">
      <span>ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰</span>
      <input id="kw" type="text" placeholder="ä¾‹ï¼šSwitch æœ‰æ©ŸEL / iPad 64GB / ãƒ«ãƒ³ãƒ j7+">
    </label>
    <label class="col">
      <span>JAN / ISBN / ASINï¼ˆä»»æ„ï¼‰</span>
      <input id="code" type="text" placeholder="ä¾‹ï¼š4902370550501 / B0CXXXXX">
    </label>
    <label class="col">
      <span>æ¡ä»¶</span>
      <select id="cond">
        <option value="">ã™ã¹ã¦</option>
        <option value="æ–°å“">æ–°å“</option>
        <option value="ä¸­å¤">ä¸­å¤</option>
      </select>
    </label>
  </div>

  <div class="actions">
    <button id="openSelected">é¸æŠã—ãŸã‚µã‚¤ãƒˆã§ä¸€æ‹¬æ¤œç´¢</button>
    <button id="clear" class="secondary">ã‚¯ãƒªã‚¢</button>
  </div>
</div>

<div class="groups">

  <!-- å¤§æ‰‹EC -->
  <section class="group">
    <h2>å¤§æ‰‹ECãƒ¢ãƒ¼ãƒ«</h2>
    <div class="sites">
      <label><input type="checkbox" class="site" data-id="amazon"> ğŸ…°ï¸ Amazonï¼ˆæ–°å“ï¼‰</label>
      <label><input type="checkbox" class="site" data-id="rakuten"> â™¨ï¸ æ¥½å¤©å¸‚å ´</label>
      <label><input type="checkbox" class="site" data-id="yahoo"> ğŸŸ¡ ãƒ¤ãƒ•ãƒ¼ã‚·ãƒ§ãƒƒãƒ”ãƒ³ã‚°</label>
      <label><input type="checkbox" class="site" data-id="kakaku"> ğŸ“Š ä¾¡æ ¼.com</label>
    </div>
    <div class="buttons">
      <a class="btn" data-id="amazon">Amazon</a>
      <a class="btn" data-id="rakuten">æ¥½å¤©</a>
      <a class="btn" data-id="yahoo">ãƒ¤ãƒ•ã‚·ãƒ§</a>
      <a class="btn" data-id="kakaku">ä¾¡æ ¼.com</a>
    </div>
  </section>

  <!-- ãƒ•ãƒªãƒ/ã‚ªãƒ¼ã‚¯ã‚·ãƒ§ãƒ³ -->
  <section class="group">
    <h2>ãƒ•ãƒªãƒ / ã‚ªãƒ¼ã‚¯ã‚·ãƒ§ãƒ³</h2>
    <div class="sites">
      <label><input type="checkbox" class="site" data-id="mercari"> ğŸŸ¥ ãƒ¡ãƒ«ã‚«ãƒª</label>
      <label><input type="checkbox" class="site" data-id="paypayflea"> ğŸŸ¡ PayPayãƒ•ãƒªãƒ</label>
      <label><input type="checkbox" class="site" data-id="yafuoku"> â›³ ãƒ¤ãƒ•ã‚ªã‚¯!</label>
      <label><input type="checkbox" class="site" data-id="rakuma"> ğŸŸ£ ãƒ©ã‚¯ãƒ</label>
    </div>
    <div class="buttons">
      <a class="btn" data-id="mercari">ãƒ¡ãƒ«ã‚«ãƒª</a>
      <a class="btn" data-id="paypayflea">PayPayãƒ•ãƒªãƒ</a>
      <a class="btn" data-id="yafuoku">ãƒ¤ãƒ•ã‚ªã‚¯!</a>
      <a class="btn" data-id="rakuma">ãƒ©ã‚¯ãƒ</a>
    </div>
  </section>

  <!-- å®¶é›»é‡è²©ã‚ªãƒ³ãƒ©ã‚¤ãƒ³ -->
  <section class="group">
    <h2>å®¶é›»é‡è²©ã‚ªãƒ³ãƒ©ã‚¤ãƒ³</h2>
    <div class="sites">
      <label><input type="checkbox" class="site" data-id="yodobashi"> ğŸŸ¦ ãƒ¨ãƒ‰ãƒã‚·</label>
      <label><input type="checkbox" class="site" data-id="bic"> ğŸŸ¥ ãƒ“ãƒƒã‚¯ã‚«ãƒ¡ãƒ©</label>
      <label><input type="checkbox" class="site" data-id="nojima"> ğŸŸ© ãƒã‚¸ãƒ</label>
      <label><input type="checkbox" class="site" data-id="edion"> ğŸ”µ ã‚¨ãƒ‡ã‚£ã‚ªãƒ³</label>
      <label><input type="checkbox" class="site" data-id="joshin"> ğŸŸ  Joshin</label>
    </div>
    <div class="buttons">
      <a class="btn" data-id="yodobashi">ãƒ¨ãƒ‰ãƒã‚·</a>
      <a class="btn" data-id="bic">ãƒ“ãƒƒã‚¯</a>
      <a class="btn" data-id="nojima">ãƒã‚¸ãƒ</a>
      <a class="btn" data-id="edion">ã‚¨ãƒ‡ã‚£ã‚ªãƒ³</a>
      <a class="btn" data-id="joshin">Joshin</a>
    </div>
  </section>

  <!-- ç©å…·/æ—¥ç”¨å“/å·¥å…·ãªã© -->
  <section class="group">
    <h2>ç©å…·/æ—¥ç”¨å“/å·¥å…· ã»ã‹</h2>
    <div class="sites">
      <label><input type="checkbox" class="site" data-id="toysrus"> ğŸ§¸ ãƒˆã‚¤ã‚¶ã‚‰ã‚¹</label>
      <label><input type="checkbox" class="site" data-id="lohaco"> ğŸ§» LOHACO</label>
      <label><input type="checkbox" class="site" data-id="monotaro"> ğŸ› ï¸ MonotaRO</label>
      <label><input type="checkbox" class="site" data-id="surugaya"> ğŸ’¿ é§¿æ²³å±‹</label>
    </div>
    <div class="buttons">
      <a class="btn" data-id="toysrus">ãƒˆã‚¤ã‚¶ã‚‰ã‚¹</a>
      <a class="btn" data-id="lohaco">LOHACO</a>
      <a class="btn" data-id="monotaro">MonotaRO</a>
      <a class="btn" data-id="surugaya">é§¿æ²³å±‹</a>
    </div>
  </section>

  <!-- å‚è€ƒï¼†å¤–éƒ¨ãƒ„ãƒ¼ãƒ« -->
  <section class="group">
    <h2>å‚è€ƒãƒªãƒ³ã‚¯ï¼ˆä»»æ„ãƒ»ãƒ­ã‚°ã‚¤ãƒ³è¦ã®å¯èƒ½æ€§ã‚ã‚Šï¼‰</h2>
    <div class="sites">
      <label><input type="checkbox" class="site" data-id="keepa"> ğŸ“ˆ Keepaï¼ˆASINï¼‰</label>
      <label><input type="checkbox" class="site" data-id="camel"> ğŸª CamelCamelï¼ˆASINï¼‰</label>
      <label><input type="checkbox" class="site" data-id="google"> ğŸ” Googleã‚·ãƒ§ãƒƒãƒ”ãƒ³ã‚°</label>
    </div>
    <div class="buttons">
      <a class="btn" data-id="keepa">Keepa</a>
      <a class="btn" data-id="camel">Camel</a>
      <a class="btn" data-id="google">Google</a>
    </div>
  </section>

</div>

<style>
.card{border:1px solid #e5e7eb;border-radius:12px;background:#fff;padding:16px;margin:10px 0}
.grid{display:grid;gap:12px;grid-template-columns:1fr 1fr 1fr}
.col{display:flex;flex-direction:column;gap:6px}
.col span{font-size:12px;color:#6b7280}
input,select{padding:8px;border:1px solid #e5e7eb;border-radius:8px;background:#fff}
.actions{display:flex;gap:8px;margin-top:12px;flex-wrap:wrap}
button{padding:10px 14px;border:1px solid #e5e7eb;border-radius:8px;background:#111;color:#fff;cursor:pointer}
button.secondary{background:#fff;color:#111}

.groups{display:grid;gap:16px;margin-top:12px}
.group{border:1px solid #e5e7eb;border-radius:12px;background:#fff;padding:12px}
.group h2{margin:0 0 8px;font-size:16px}
.sites{display:flex;flex-wrap:wrap;gap:10px;margin-bottom:8px}
.sites label{display:flex;gap:6px;align-items:center;border:1px solid #e5e7eb;border-radius:999px;padding:6px 10px;background:#fff;cursor:pointer}
.buttons{display:flex;flex-wrap:wrap;gap:8px}
a.btn{display:inline-block;padding:8px 12px;border:1px solid #e5e7eb;border-radius:10px;background:#f8fafc;color:#111;text-decoration:none;cursor:pointer}
a.btn:hover{border-color:#cbd5e1}

@media (max-width:980px){.grid{grid-template-columns:1fr 1fr}}
@media (max-width:640px){.grid{grid-template-columns:1fr}}
</style>

<script>
(() => {
  const $  = (q)=>document.querySelector(q);
  const $$ = (q)=>Array.from(document.querySelectorAll(q));

  const kw    = $('#kw');
  const code  = $('#code');
  const cond  = $('#cond');

  // ã‚µã‚¤ãƒˆã”ã¨ã®æ¤œç´¢URLã‚’å®šç¾©ï¼ˆ{q}=ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã€{c}=ã‚³ãƒ¼ãƒ‰ï¼‰
  const URLS = {
    // å¤§æ‰‹EC
    amazon:    q => `https://www.amazon.co.jp/s?k=${encodeURIComponent(q)}`,
    rakuten:   q => `https://search.rakuten.co.jp/search/mall/${encodeURIComponent(q)}/`,
    yahoo:     q => `https://shopping.yahoo.co.jp/search?p=${encodeURIComponent(q)}`,
    kakaku:    q => `https://kakaku.com/search_results/${encodeURIComponent(q)}/`,

    // ãƒ•ãƒªãƒ/ã‚ªã‚¯
    mercari:   q => `https://www.mercari.com/jp/search/?keyword=${encodeURIComponent(q)}`,
    paypayflea:q => `https://paypayfleamarket.yahoo.co.jp/search/%E6%A4%9C%E7%B4%A2?query=${encodeURIComponent(q)}`,
    yafuoku:   q => `https://auctions.yahoo.co.jp/search/search?p=${encodeURIComponent(q)}`,
    rakuma:    q => `https://fril.jp/s?query=${encodeURIComponent(q)}`,

    // å®¶é›»é‡è²©
    yodobashi: q => `https://www.yodobashi.com/?word=${encodeURIComponent(q)}`,
    bic:       q => `https://www.biccamera.com/bc/item/?q=${encodeURIComponent(q)}`,
    nojima:    q => `https://online.nojima.co.jp/app/catalog/list/init?searchMethod=2&searchText=${encodeURIComponent(q)}`,
    edion:     q => `https://www.edion.com/Search?keyword=${encodeURIComponent(q)}`,
    joshin:    q => `https://joshinweb.jp/search/?key=${encodeURIComponent(q)}`,

    // ç©å…·/æ—¥ç”¨å“/å·¥å…·
    toysrus:   q => `https://www.toysrus.co.jp/search/?q=${encodeURIComponent(q)}`,
    lohaco:    q => `https://lohaco.yahoo.co.jp/search/?p=${encodeURIComponent(q)}`,
    monotaro:  q => `https://www.monotaro.com/s/?f.keyword=${encodeURIComponent(q)}`,
    surugaya:  q => `https://www.suruga-ya.jp/search?category=&search_word=${encodeURIComponent(q)}`,

    // å‚è€ƒãƒ„ãƒ¼ãƒ«
    keepa:   _ => code.value ? `https://keepa.com/#!product/5-${encodeURIComponent(code.value)}` : '',
    camel:   _ => code.value ? `https://camelcamelcamel.com/search?sq=${encodeURIComponent(code.value)}` : '',
    google:  q => `https://www.google.com/search?tbm=shop&q=${encodeURIComponent(q)}`
  };

  // æ¡ä»¶ï¼ˆæ–°å“/ä¸­å¤ï¼‰ã‚’ç°¡æ˜“çš„ã«ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã¸åæ˜ 
  function buildQuery() {
    const base = (kw.value || '').trim();
    const c = (code.value || '').trim();
    const tag = cond.value ? ` ${cond.value}` : '';
    // ã‚³ãƒ¼ãƒ‰ãŒã‚ã‚Œã°ä»˜åŠ ï¼ˆãƒ¡ãƒ«ã‚«ãƒªãªã©ã§ã‚‚å¼•ã£ã‹ã‹ã‚‹ï¼‰
    return (c ? `${base} ${c}${tag}`.trim() : `${base}${tag}`.trim());
  }

  function openSite(id){
    const q = buildQuery();
    if(!q){ alert('ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„'); return; }
    const fn = URLS[id];
    if(!fn){ return; }
    const url = fn(q);
    if(!url){ alert('ãã®ã‚µã‚¤ãƒˆã¯ã‚³ãƒ¼ãƒ‰ï¼ˆASIN/JANï¼‰ãŒå¿…è¦ã§ã™'); return; }
    window.open(url, '_blank');
  }

  // å„ãƒœã‚¿ãƒ³ï¼šå˜ç™ºã‚ªãƒ¼ãƒ—ãƒ³
  $$('.buttons .btn').forEach(btn=>{
    btn.addEventListener('click', e=>{
      e.preventDefault();
      const id = btn.dataset.id;
      openSite(id);
    });
  });

  // ä¸€æ‹¬ã‚ªãƒ¼ãƒ—ãƒ³
  $('#openSelected').addEventListener('click', ()=>{
    const selected = $$('.sites .site:checked').map(x=>x.dataset.id);
    if(selected.length===0){ alert('ã‚µã‚¤ãƒˆã‚’é¸æŠã—ã¦ãã ã•ã„'); return; }
    const q = buildQuery();
    if(!q){ alert('ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„'); return; }
    for(const id of selected){
      const fn = URLS[id];
      if(!fn) continue;
      const url = fn(q);
      if(!url) continue;
      window.open(url, '_blank');
    }
  });

  // ã‚¯ãƒªã‚¢
  $('#clear').addEventListener('click', ()=>{
    kw.value = ''; code.value = ''; cond.value = '';
    $$('.sites .site').forEach(x=>x.checked = false);
    kw.focus();
  });

  // Enterã§ä¸€æ‹¬ã‚ªãƒ¼ãƒ—ãƒ³
  kw.addEventListener('keydown', e=>{
    if(e.key === 'Enter'){ e.preventDefault(); $('#openSelected').click(); }
  });
})();
</script>

{% endblock %}

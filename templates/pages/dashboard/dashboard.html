{% extends "base/layout.html" %}
{% block title %}ç®¡ç†ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ | ãƒªã‚µãƒ¼ãƒãƒŠãƒ“{% endblock %}
{% block content %}

<div class="d-flex">
  <!-- ã‚µã‚¤ãƒ‰ãƒãƒ¼ -->
  <nav class="flex-shrink-0 p-3 bg-light border-end" style="width: 240px; min-height: 100vh;">
    <a href="/" class="d-flex align-items-center mb-3 text-dark text-decoration-none">
      <span class="fs-5 fw-bold">ãƒªã‚µãƒ¼ãƒãƒŠãƒ“</span>
    </a>
    <hr>
    <ul class="nav nav-pills flex-column mb-auto">
      <li class="nav-item">
        <a href="/" class="nav-link">ğŸ  ãƒ›ãƒ¼ãƒ </a>
      </li>
      <li>
        <a href="/dashboard" class="nav-link active">ğŸ“Š ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰</a>
      </li>
      <li>
        <a href="#stock" class="nav-link">ğŸ“¦ åœ¨åº«ç®¡ç†</a>
      </li>
      <li>
        <a href="#alerts" class="nav-link">âš  ã‚¢ãƒ©ãƒ¼ãƒˆ</a>
      </li>
    </ul>
  </nav>

  <!-- ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ -->
  <div class="flex-grow-1 p-4" style="background-color: #f8f9fa;">
    <h2 class="mb-4">ğŸ“Š ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰</h2>

    <!-- ã‚µãƒãƒªãƒ¼ -->
    <div class="row g-3 mb-4">
      <div class="col-md-3 col-6">
        <div class="card shadow-sm text-center">
          <div class="card-body">
            <h6 class="text-muted">ä»Šæ—¥ã®å£²ä¸Š</h6>
            <h4 class="fw-bold text-success">{{ today_sales | int }} å††</h4>
          </div>
        </div>
      </div>
      <div class="col-md-3 col-6">
        <div class="card shadow-sm text-center">
          <div class="card-body">
            <h6 class="text-muted">ä»Šæ—¥ã®åˆ©ç›Š</h6>
            <h4 class="fw-bold text-info">{{ today_profit | int }} å††</h4>
          </div>
        </div>
      </div>
      <div class="col-md-3 col-6">
        <div class="card shadow-sm text-center">
          <div class="card-body">
            <h6 class="text-muted">ä»Šæœˆã®å£²ä¸Š</h6>
            <h4 class="fw-bold text-primary">{{ monthly_sales | int }} å††</h4>
          </div>
        </div>
      </div>
      <div class="col-md-3 col-6">
        <div class="card shadow-sm text-center">
          <div class="card-body">
            <h6 class="text-muted">ä»Šæœˆã®åˆ©ç›Š</h6>
            <h4 class="fw-bold text-warning">{{ monthly_profit | int }} å††</h4>
          </div>
        </div>
      </div>
    </div>

    <!-- å£²ä¸Šã‚°ãƒ©ãƒ• -->
    <div class="card shadow-sm mb-4">
      <div class="card-body">
        <h6 class="card-title">ğŸ“ˆ ç›´è¿‘7æ—¥é–“ã®å£²ä¸Š</h6>
        <canvas id="salesChart"></canvas>
      </div>
    </div>

    <div class="row g-3">
      <!-- åœ¨åº« -->
      <div class="col-md-6" id="stock">
        <div class="card shadow-sm">
          <div class="card-body">
            <h6 class="card-title">ğŸ“¦ åœ¨åº«ãƒˆãƒƒãƒ—5</h6>
            <table class="table table-striped table-sm">
              <thead>
                <tr>
                  <th>å•†å“</th>
                  <th>åœ¨åº«æ•°</th>
                  <th>ã‚«ãƒ†ã‚´ãƒª</th>
                </tr>
              </thead>
              <tbody>
                {% for row in stock_df.itertuples() %}
                <tr>
                  <td>{{ row.item }}</td>
                  <td>{{ row.stock }}</td>
                  <td>{{ row.category }}</td>
                </tr>
                {% endfor %}
              </tbody>
            </table>
          </div>
        </div>
      </div>

      <!-- ã‚¢ãƒ©ãƒ¼ãƒˆ -->
      <div class="col-md-6" id="alerts">
        <div class="card shadow-sm">
          <div class="card-body">
            <h6 class="card-title">âš  æœ€æ–°ã‚¢ãƒ©ãƒ¼ãƒˆ</h6>
            <ul class="list-group list-group-flush">
              {% for row in alert_df.itertuples() %}
              <li class="list-group-item d-flex justify-content-between align-items-center">
                <span>{{ row.date }} - {{ row.message }}</span>
                <span class="badge bg-danger">{{ row.level }}</span>
              </li>
              {% endfor %}
              {% if alert_df.empty %}
              <li class="list-group-item text-muted">ã‚¢ãƒ©ãƒ¼ãƒˆã¯ã‚ã‚Šã¾ã›ã‚“</li>
              {% endif %}
            </ul>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
  const ctx = document.getElementById("salesChart");
  new Chart(ctx, {
    type: "bar",
    data: {
      labels: {{ chart_labels|tojson }},
      datasets: [{
        label: "å£²ä¸Š (å††)",
        data: {{ chart_values|tojson }},
        backgroundColor: "rgba(54, 162, 235, 0.7)",
        borderColor: "rgba(54, 162, 235, 1)",
        borderWidth: 1
      }]
    },
    options: {
      responsive: true,
      plugins: {
        legend: { display: false }
      }
    }
  });
</script>

{% endblock %}

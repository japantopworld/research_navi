{% extends "base/layout.html" %}
{% block title %}ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ»éƒ¨ç½²ç®¡ç† | ãƒªã‚µãƒ¼ãƒãƒŠãƒ“{% endblock %}
{% block content %}
<h1>ğŸ‘¥ ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ»éƒ¨ç½²ç®¡ç†</h1>
<form method="get" class="row gap">
  <input type="text" name="q" value="{{ q }}" placeholder="ID/æ°å/ãƒ¡ãƒ¼ãƒ«æ¤œç´¢">
  <button class="btn">æ¤œç´¢</button>
</form>

<div class="grid-2">
  <div class="card">
    <h3>ãƒ¦ãƒ¼ã‚¶ãƒ¼ä¸€è¦§ï¼ˆæœ€æ–°200ä»¶ï¼‰</h3>
    <table class="table">
      <thead><tr><th>ID</th><th>æ°å</th><th>éƒ¨ç½²</th><th>ãƒ­ãƒ¼ãƒ«</th><th>é€£çµ¡å…ˆ</th><th>çŠ¶æ…‹</th><th>æ“ä½œ</th></tr></thead>
      <tbody>
        {% for u in items %}
        <tr>
          <td>{{ u.user_id }}</td>
          <td>{{ u.display_name }}</td>
          <td>{{ u.department_code or '-' }}</td>
          <td>{{ u.role_id or '-' }}</td>
          <td>{{ u.email or '' }}<br>{{ u.phone or '' }}</td>
          <td>{{ 'æœ‰åŠ¹' if u.is_active else 'åœæ­¢' }}</td>
          <td>
            <details>
              <summary>ç·¨é›†</summary>
              <form method="post" action="{{ url_for('general_bp.users_update', user_pk=u.id) }}" class="mini-form">
                <input type="text" name="display_name" value="{{ u.display_name }}">
                <input type="text" name="department_code" value="{{ u.department_code or '' }}" placeholder="éƒ¨ç½²ã‚³ãƒ¼ãƒ‰">
                <input type="email" name="email" value="{{ u.email or '' }}" placeholder="email">
                <input type="text" name="phone" value="{{ u.phone or '' }}" placeholder="phone">
                <select name="role_id">
                  <option value="">(å¤‰æ›´ãªã—)</option>
                  {% for r in roles %}
                  <option value="{{ r.id }}" {% if u.role_id==r.id %}selected{% endif %}>{{ r.name }}</option>
                  {% endfor %}
                </select>
                <label><input type="checkbox" name="is_active" {% if u.is_active %}checked{% endif %}> æœ‰åŠ¹</label>
                <button class="btn">ä¿å­˜</button>
              </form>
            </details>
          </td>
        </tr>
        {% else %}
        <tr><td colspan="7" class="muted">ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒã„ã¾ã›ã‚“ã€‚</td></tr>
        {% endfor %}
      </tbody>
    </table>
  </div>

  <div class="card">
    <h3>æ–°è¦ãƒ¦ãƒ¼ã‚¶ãƒ¼</h3>
    <form method="post" action="{{ url_for('general_bp.users_create') }}">
      <input type="text" name="user_id" placeholder="ID (å¿…é ˆ)" required>
      <input type="text" name="display_name" placeholder="æ°å (å¿…é ˆ)" required>
      <input type="text" name="department_code" placeholder="éƒ¨ç½²ã‚³ãƒ¼ãƒ‰ (ä¾‹: GEN)">
      <input type="email" name="email" placeholder="ãƒ¡ãƒ¼ãƒ«">
      <input type="text" name="phone" placeholder="é›»è©±ç•ªå·">
      <select name="role_id">
        <option value="">ãƒ­ãƒ¼ãƒ«æœªè¨­å®š</option>
        {% for r in roles %}
        <option value="{{ r.id }}">{{ r.name }}</option>
        {% endfor %}
      </select>
      <button class="btn">ä½œæˆ</button>
    </form>

    <hr>
    <h3>éƒ¨ç½²ä¸€è¦§</h3>
    <table class="table">
      <thead><tr><th>ã‚³ãƒ¼ãƒ‰</th><th>åç§°</th></tr></thead>
      <tbody>
        {% for d in depts %}
        <tr><td>{{ d.code }}</td><td>{{ d.name }}</td></tr>
        {% else %}
        <tr><td colspan="2" class="muted">éƒ¨ç½²ãªã—</td></tr>
        {% endfor %}
      </tbody>
    </table>

    <details>
      <summary>éƒ¨ç½²ã®è¿½åŠ </summary>
      <form method="post" action="{{ url_for('general_bp.departments_create') }}">
        <input type="text" name="code" placeholder="GEN / BUY / SAL / LOG ãªã©" required>
        <input type="text" name="name" placeholder="éƒ¨ç½²å" required>
        <button class="btn">è¿½åŠ </button>
      </form>
    </details>
  </div>
</div>
{% endblock %}

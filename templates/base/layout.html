<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>{% block title %}ãƒªã‚µãƒ¼ãƒãƒŠãƒ“{% endblock %}</title>

  <!-- PWA -->
  <meta name="theme-color" content="#111111">
  <link rel="manifest" href="{{ url_for('static', filename='manifest.webmanifest') }}">
  <link rel="icon" href="{{ url_for('static', filename='img/icon-192.png') }}" sizes="192x192">
  <link rel="apple-touch-icon" href="{{ url_for('static', filename='img/icon-192.png') }}">

  <!-- CSS -->
  <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
  <style>
    .toast{position:fixed;left:50%;bottom:16px;transform:translateX(-50%);
      background:#111;color:#fff;padding:8px 12px;border-radius:10px;
      box-shadow:0 6px 24px rgba(0,0,0,.18);font-size:14px;display:none;z-index:9999}
    .toast.show{display:block}
    .topbar{border-bottom:1px solid #e5e7eb;background:#fff}
    .topbar .container{max-width:1000px;margin:0 auto;padding:12px 16px;display:flex;gap:12px;align-items:center;flex-wrap:wrap}
    .brand{font-weight:700;text-decoration:none;color:#111}
    .nav{display:flex;gap:10px;flex-wrap:wrap}
    .nav a{color:#111;text-decoration:none;padding:6px 8px;border-radius:8px}
    .nav a:hover{background:#f3f4f6}
    .container{max-width:1000px;margin:0 auto;padding:16px}
    .flash>div{background:#ecfeff;border:1px solid #a5f3fc;padding:10px;border-radius:10px;margin:12px 0}
    .footer{border-top:1px solid #e5e7eb;margin-top:40px;color:#6b7280;font-size:12px}
  </style>
</head>
<body>

<header class="topbar">
  <div class="container">
    <a href="{{ url_for('home') }}" class="brand">ğŸš€ ãƒªã‚µãƒ¼ãƒãƒŠãƒ“</a>
    <nav class="nav">
      <a href="{{ url_for('search') }}">ğŸ” æ¤œç´¢</a>
      <a href="{{ url_for('profit') }}">ğŸ’° åˆ©ç›Šè¨ˆç®—</a>
      <a href="{{ url_for('history') }}">ğŸ“œ å±¥æ­´</a>
      <a href="{{ url_for('ranking') }}">ğŸ“ˆ ãƒ©ãƒ³ã‚­ãƒ³ã‚°</a>
      <a href="{{ url_for('notifications') }}">ğŸ“£ é€šçŸ¥</a>
      <a href="{{ url_for('ocr') }}">ğŸ“· OCR</a>
      <a href="{{ url_for('suppliers') }}">ğŸª ä»•å…¥ã‚Œå…ˆ</a>
      <a href="{{ url_for('setting') }}">âš™ï¸ è¨­å®š</a>
    </nav>
  </div>
</header>

<main class="container">
  {% with msgs = get_flashed_messages() %}
    {% if msgs %}
      <div class="flash">
        {% for m in msgs %}<div>{{ m }}</div>{% endfor %}
      </div>
    {% endif %}
  {% endwith %}
  {% block content %}{% endblock %}
</main>

<footer class="footer">
  <div class="container">Â© ãƒªã‚µãƒ¼ãƒãƒŠãƒ“</div>
</footer>

<!-- PWA: Service Worker ç™»éŒ² & æ›´æ–°é€šçŸ¥ -->
<div id="toast" class="toast">æ–°ã—ã„ãƒãƒ¼ã‚¸ãƒ§ãƒ³ãŒã‚ã‚Šã¾ã™ã€‚å†èª­ã¿è¾¼ã¿ã§æ›´æ–°ã•ã‚Œã¾ã™ã€‚</div>
<script>
  (function(){
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', function() {
        navigator.serviceWorker.register('{{ url_for("static", filename="sw.js") }}')
          .then(function(reg){
            reg.addEventListener('updatefound', function(){
              const nw = reg.installing;
              nw && nw.addEventListener('statechange', function(){
                if (nw.state === 'installed' && navigator.serviceWorker.controller) {
                  const t=document.getElementById('toast'); t.classList.add('show');
                  setTimeout(()=>location.reload(), 2500);
                }
              });
            });
          })
          .catch(function(e){ console.log('SW register failed:', e); });
      });
    }
  })();
</script>

</body>
</html>
